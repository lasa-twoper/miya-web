/*
 * Boxer [Formstone Library]
 * @author Ben Plum
 * @version 1.6.6
 *
 * Copyright Â© 2013 Ben Plum <mr@benplum.com>
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
 
jQuery&&function(a){function f(c){return b.formatter=m,a(this).on("click.boxer",a.extend({},b,c||{}),g)}function g(b){b.preventDefault(),b.stopPropagation();var d=a(this),e=b.data.$object,f=d.attr("href")||"",g=f.toLowerCase().split("."),h=g[g.length-1],m=d.data("type")||"",n="image"==m||"jpeg"==h||"jpg"==h||"gif"==h||"png"==h||"data:image"==f.substr(0,10);if(1>a("#boxer").length&&n){if(c={$target:d,$object:e,gallery:{active:!1},options:b.data},c.type=n?"image":"element",n){var r=c.$target.attr("rel");r!==void 0&&r!==!1&&(c.gallery.active=!0,c.gallery.rel=r,c.gallery.$items=a("a[rel= "+c.gallery.rel+"]"),c.gallery.index=c.gallery.$items.index(c.$target),c.gallery.total=c.gallery.$items.length-1)}var s='<div id="boxer-overlay" class="'+c.options.customClass+'" style="opacity: 0"></div>';s+='<div id="boxer" class="'+c.options.customClass,s+='" style="opacity: 0;',c.options.fixed===!0&&(s+=" position: fixed;"),s+='">',s+='<span class="boxer-close">Close</span>',s+='<div class="boxer-container" style="opacity: 0; height: '+c.options.height+"px; width: "+c.options.width+'px">',s+='<div class="boxer-content">',n&&(s+='<div class="boxer-meta">',c.gallery.active?(s+='<p class="boxer-position"',1>c.gallery.total&&(s+=' style="display: none;"'),s+=">",s+='<span class="current">'+(c.gallery.index+1)+'</span> of <span class="total">'+(c.gallery.total+1)+"</span>",s+="</p>",s+='<div class="boxer-arrow previous">Previous</div>',s+='<div class="boxer-arrow next">Next</div>',s+='<div class="boxer-caption gallery">'):s+='<div class="boxer-caption">',s+=c.options.formatter.apply(a("body"),[c.$target]),s+="</div></div>"),s+="</div></div></div>",a("body").append(s),c.$overlay=a("#boxer-overlay"),c.$boxer=a("#boxer"),c.$container=c.$boxer.find(".boxer-container"),c.$content=c.$boxer.find(".boxer-content"),c.$meta=c.$boxer.find(".boxer-meta"),c.$position=c.$boxer.find(".boxer-position"),c.$caption=c.$boxer.find(".boxer-caption"),c.$arrows=c.$boxer.find(".boxer-arrow"),c.$animatables=a("#boxer-overlay, #boxer"),c.padding=2*parseInt(c.$boxer.css("paddingTop"),10),k(),c.gallery.active&&p(),a(window).on("resize.boxer",j).on("keydown.boxer",q),a("body").on("click.boxer","#boxer-overlay, #boxer .boxer-close",i),c.gallery.active&&c.$boxer.on("click.boxer",".boxer-arrow",o),c.$overlay.stop().animate({opacity:c.options.opacity},c.options.duration),c.$boxer.stop().animate({opacity:1},c.options.duration,function(){n?l(f):a.error("BOXER: '"+f+"' is not valid.")})}}function h(){var b=(a(window).width()-c.contentWidth-c.padding)/2,d=0>=c.options.top?(a(window).height()-c.contentHeight-c.padding)/2:c.options.top;c.options.fixed!==!0&&(d+=a(window).scrollTop());var e=c.$arrows.outerHeight();c.$arrows.css({marginTop:(c.contentHeight-c.metaHeight-e)/2}),c.$boxer.stop().animate({left:b,top:d},c.options.duration),c.$container.show().stop().animate({height:c.contentHeight,width:c.contentWidth},c.options.duration,function(){c.$container.stop().animate({opacity:1},c.options.duration),c.$boxer.find(".boxer-close").stop().animate({opacity:1},c.options.duration),c.options.callback.apply(c.$boxer)})}function i(b){b.preventDefault(),b.stopPropagation(),c.$animatables!==void 0&&(c.$animatables.stop().animate({opacity:0},c.options.duration,function(){a(this).remove()}),clearTimeout(d),d=null,a(window).off(".boxer"),a("body").off(".boxer"),c.gallery.active&&c.$boxer.off(".boxer"),c={})}function j(){null!==d&&(clearTimeout(d),d=null),d=setTimeout(function(){k()},10)}function k(){var b=(a(window).width()-c.$boxer.width()-c.padding)/2,d=0>=c.options.top?(a(window).height()-c.$boxer.height()-c.padding)/2:c.options.top;c.options.fixed!==!0&&(d+=a(window).scrollTop()),c.$boxer.css({left:b,top:d})}function l(b){c.$image=a("<img />"),c.$image.one("load.boxer",function(){c.originalHeight=c.$image[0].height,c.originalWidth=c.$image[0].width,c.options.retina&&(c.originalHeight/=2,c.originalWidth/=2),c.$content.prepend(c.$image),""==c.$caption.html()?c.$caption.hide():c.$caption.show(),n(0)&&h()}).attr("src",b).addClass("boxer-image"),c.$image[0].complete&&c.$image.trigger("load")}function m(a){var b=a.attr("title");return""!=b&&void 0!==b?'<p class="caption">'+b+"</p>":""}function n(b){var d=0==b?c.originalHeight:c.$image.outerHeight(),e=0==b?c.originalWidth:c.$image.outerWidth(),f=0==b?0:c.metaHeight,g=a(window).width()-c.options.margin-c.padding,h=a(window).height()-c.options.margin-c.padding-f;c.options.minHeight>d&&(c.options.minHeight=d),c.options.minWidth>e&&(c.options.minWidth=e);var k,i=e,j=d;return e>d?(k=d/e,i=g,j=i*k,j>h&&(k=e/d,j=h,i=j*k)):(k=e/d,j=h,i=j*k,i>g&&(k=d/e,i=g,j=i*k)),(i>e||j>d)&&(i=e,j=d),(c.options.minWidth>i||c.options.minHeight>j)&&(d>e?(k=d/e,i=c.options.minWidth,j=i*k):(k=e/d,j=c.options.minHeight,i=j*k)),c.$content.css({width:i}),c.$meta.css({width:i}),c.$image.css({height:j,width:i}),c.metaHeight=c.$meta.outerHeight(!0),c.contentWidth=i,c.contentHeight=j+c.metaHeight,c.contentHeight>h&&2>b?n(b+1):!0}function o(b){b.preventDefault(),b.stopPropagation();var d=a(this);d.hasClass("disabled")||(c.gallery.index+=d.hasClass("next")?1:-1,c.gallery.index>c.gallery.total&&(c.gallery.index=c.gallery.total),0>c.gallery.index&&(c.gallery.index=0),c.$container.stop().animate({opacity:0},c.options.duration,function(){c.$image!==void 0&&c.$image.remove(),c.$videoWrapper!==void 0&&c.$videoWrapper.remove(),c.$target=c.gallery.$items.eq(c.gallery.index),c.$caption.html(c.options.formatter.apply(a("body"),[c.$target])),c.$position.find(".current").html(c.gallery.index+1);var b=c.$target.attr("href");l(b),p()}))}function p(){c.$arrows.removeClass("disabled"),0==c.gallery.index&&c.$arrows.filter(".previous").addClass("disabled"),c.gallery.index==c.gallery.total&&c.$arrows.filter(".next").addClass("disabled")}function q(a){!c.gallery.active||37!=a.keyCode&&39!=a.keyCode?27==a.keyCode&&c.$boxer.find(".boxer-close").trigger("click"):(a.preventDefault(),a.stopPropagation(),c.$arrows.filter(37==a.keyCode?".previous":".next").trigger("click"))}var b={callback:a.noop,customClass:"",duration:250,fixed:!1,formatter:a.noop,height:100,margin:100,minHeight:200,minWidth:200,opacity:.75,retina:!1,requestKey:"boxer",top:0,width:100},c={},d=null,e={destroy:function(){return i(a.Event("click")),a(this).off(".boxer")},resize:function(){c.$boxer!==void 0&&("image"==c.type&&n(1),h())}};a.fn.boxer=function(a){return e[a]?e[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?this:f.apply(this,arguments)},a.boxer=function(c,d){return g(a.Event("click",{data:a.extend({$object:c},b,d||{})}))}}(jQuery);